%Clear the command window
clc

%Set pathways
inputDir = ('./manipulatedImages');
input = dir(inputDir);

%Remove Non-Folders and (. & ..) folders
input(~[input.isdir]) = [];
mask = ismember({input.name}, {'.', '..'});
input(mask) = [];

%Count number of subfolders
inputLength = length(input);

%Print information
fprintf('The number of main subfolders is: %s\n', num2str(inputLength));

totalImageCount = 0;

%Open alexnet
net = alexnet;
layers = net.Layers;
inlayer = layers(1);
outlayer = layers(end);
categorynames = outlayer.ClassNames;
predictions = [];
scores = [];

%Read in images
for subFolderX = 1:inputLength
          %Set folder
            inFolder = fullfile(inputDir, input(subFolderX).name);

            %Print information
            fprintf('Reading images from: %s\n', inFolder); 
           
            %Open folder and move images into set
            inImageSet = dir(fullfile(inFolder, '*.jpg'));
            inImageSetLength = length(inImageSet);
            disp(inImageSetLength)
            totalImageCount = totalImageCount + inImageSetLength;
            
            for imageNum = 1:inImageSetLength
                    %Open Images
                    inName = strcat(inImageSet(imageNum).folder, '/', inImageSet(imageNum).name);
                    
                    %Disp image names
                    disp(inImageSet(imageNum).name);
                    
                    %Add image to datastore
                    imds = imageDatastore(inName);
                    
                    %Classify image
                    [pred, score] = classify(net, imds);
                    predictions = [predictions; pred];
                    scores = [scores; score];
            end
            disp('----------------------------------------');          
end
disp("The total image count is:");
disp(totalImageCount);

%Graph the predictions
bar(scores);

highscores = scores > 0.01;
bar(scores(highscores));
xticklabels(categorynames);

disp("The analysis is complete");